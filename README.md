Checkout the branch "overhaul" for the final implementation.
